<!DOCTYPE html>
<html class="no-js">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title></title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">

    <link rel="stylesheet" href="css/normalize.css">
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/popup.css">
    <link rel="stylesheet" href="css/reader_custom.css">
    <!--third party libs-->
    <script src="js/libs/jquery.min.js"></script>
    <script src="js/verify.js"></script>
    <script src="js/libs/zip.min.js"></script>
    <script src="js/libs/clipboard.min.js"></script>

    <script>
      'use strict'

      class initPage {
        constructor() {
          this.getBook()
          this.searchBar()
          this.copiedLink = ''
          this.fontSize = '14px'
          this.showSearchBar = false
          localStorage.removeItem('fontSize')
        }


        getBook() {
          // get bookName from the cookie
          const bookName = localStorage.getItem('book')
          console.log(`./book/${bookName}.epub`)
          // start reader by book name
          document.onreadystatechange = function () {
            if (document.readyState == 'complete') {
              window.reader = ePubReader(`./book/${bookName}.epub`, {
                restore: true
              })
            }
          }
        }

        searchBar() {
          var cx = '007172865999873295840:zvftfiyuczi'
          var gcse = document.createElement('script')
          gcse.type = 'text/javascript'
          gcse.async = true
          gcse.src = 'https://cse.google.com/cse.js?cx=' + cx
          var s = document.getElementsByTagName('script')[0]
          s.parentNode.insertBefore(gcse, s)

          window.onload = function () {
            var searchBox = document.getElementById('gsc-i-id1')
            searchBox.placeholder = 'Search your favorite verse or song'
            searchBox.title = 'Search your favorite verse or song'
          }
        }

      }

      let app = new initPage()


      const setFont = (size) => {
        console.log(size)
        let ifm = document.querySelector('iframe')
        let innerDoc = ifm.contentDocument || ifm.contentWindow.document
        let fontEl = innerDoc.querySelector('html')
        let style = window.getComputedStyle(fontEl, null).getPropertyValue('font-size')
        let fontSize = parseFloat(style)

        // console.log(fontSize)
        if (size === '+')
          app.fontSize = ` ${fontSize + 1}px`
        else
          app.fontSize = ` ${fontSize - 1}px`
        fontEl.style.fontSize = app.fontSize
        localStorage.setItem('fontSize', app.fontSize)
      }


      const copyLink = () => {
        console.log('clicked')

        if (app.copiedLink != document.location.href) {
          app.copiedLink = document.location.href
          const el = document.createElement('textarea')
          el.value = app.copiedLink
          document.body.appendChild(el)
          el.select()
          document.execCommand('copy')
          document.body.removeChild(el)

          alert('You can paste and share now')
        }
        else {
          alert('You already copied')
        }
      }

      const showSearchBar = () => {
        // console.log('pressed', app.showSearchBar)
        //
        //   // var mainDiv = document.querySelector('#main')
        //   var mainDiv = document.querySelector('#main')
        //   var searchBar = document.createElement('gcse:search')
        //   mainDiv.insertBefore(searchBar, mainDiv.childNodes[0])
        //   app.searchBar()
        //   app.showSearchBar = true
      }

    </script>

    <!-- File Storage -->
    <!-- <script src="js/libs/localforage.min.js"></script> -->

    <!-- Full Screen -->
    <script src="js/libs/screenfull.min.js"></script>

    <!-- Render -->
    <script src="js/epub.js"></script>

    <!-- Reader -->
    <script src="js/reader.js"></script>

    <!-- Plugins -->
    <!-- <script src="js/plugins/search.js"></script> -->

    <!-- Highlights -->
    <!-- <script src="js/libs/jquery.highlight.js"></script> -->
    <!-- <script src="js/hooks/extensions/highlight.js"></script> -->

</head>
<body>
<div id="sidebar">
    <div id="panels">
        <!-- <input id="searchBox" placeholder="search" type="search"> -->

        <!-- <a id="show-Search" class="show_view icon-search" data-view="Search">Search</a> -->
        <a id="show-Toc" class="show_view icon-list-1 active" data-view="Toc">TOC</a>
        <a id="show-Bookmarks" class="show_view icon-bookmark" data-view="Bookmarks">Bookmarks</a>
        <!-- <a id="show-Notes" class="show_view icon-edit" data-view="Notes">Notes</a> -->

    </div>
    <div id="tocView" class="view">
    </div>
    <div id="searchView" class="view">
        <ul id="searchResults"></ul>
    </div>
    <div id="bookmarksView" class="view">
        <ul id="bookmarks"></ul>
    </div>
    <div id="notesView" class="view">
        <div id="new-note">
            <textarea id="note-text"></textarea>
            <button id="note-anchor">Anchor</button>
        </div>
        <ol id="notes"></ol>
    </div>
</div>
<div id="main">


    <div id="titlebar">
        <div id="opener">
            <a id="slider" class="icon-menu">Menu</a>
        </div>
        <div id="metainfo">
            <span id="book-title"></span>
            <span id="title-seperator">&nbsp;&nbsp;–&nbsp;&nbsp;</span>
            <span id="chapter-title"></span>
        </div>
        <div id="title-controls">
            <a href="#" id="bigger-font" onclick="setFont('+')">A</a>
            <a href="#" id="smaller-font" onclick="setFont('-')">a</a>
            <!--<a href="#" id="search-button" onclick="showSearchBar()">Search</a>-->
            <a id="bookmark" class="icon-bookmark-empty">Bookmark</a>
            <a id="setting" class="icon-cog">Settings</a>
            <a id="fullscreen" class="icon-resize-full">Fullscreen</a>
        </div>
    </div>

    <div id="divider"></div>
    <div id="prev" class="arrow">‹</div>
    <div id="viewer"></div>
    <div id="next" class="arrow">›</div>

    <div id="loader"><img src="img/loader.gif"></div>
</div>
<div class="modal md-effect-1" id="settings-modal">
    <div class="md-content">
        <h3>Settings</h3>
        <div class="settings">
            <ul>
                <a href="./">
                    <li>Return to Library</li>
                </a>
                <a href="javascript:void(0);" onclick="copyLink()">
                    <li>Copy this link</li>
                </a>

            </ul>
            <a id="admin" href="javascript:void(0);">
                Powered by Jun Guo</a>

        </div>

        <div class="closer icon-cancel-circled"></div>
    </div>

</div>


<div class="overlay">
</div>
</body>
</html>
